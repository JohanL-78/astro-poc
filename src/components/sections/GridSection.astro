---
import { urlForImage } from '../../sanity/lib/image';
import { stegaClean } from '@sanity/client/stega';

interface Props {
  section: any;
}

const { section } = Astro.props;
const columns = stegaClean(section.columns) || 3;
---

<section class="grid-section">
  {section.heading && <h2 class="grid-heading">{section.heading}</h2>}
  <div class="grid-items" style={`--columns: ${columns}`}>
    {section.items?.map((item: any) => {
      const imageUrl = urlForImage(item.image)?.width(600).height(400).url();
      return (
        <div class="grid-item">
          {imageUrl && (
            <img
              src={imageUrl}
              alt={item.image?.alt || ''}
              loading="lazy"
            />
          )}
          <div class="grid-item-content">
            <h3>{item.title}</h3>
            {item.description && <p>{item.description}</p>}
            {item.link?.text && item.link?.url && (
              <a href={item.link.url} class="grid-link">{item.link.text}</a>
            )}
          </div>
        </div>
      );
    })}
  </div>
</section>

<style>
  .grid-section {
    padding: var(--space-3xl) var(--space-xl);
  }

  .grid-heading {
    font-size: var(--text-4xl);
    text-align: center;
    margin-bottom: var(--space-2xl);
  }

  .grid-items {
    display: grid;
    grid-template-columns: repeat(var(--columns), 1fr);
    gap: var(--space-xl);
    max-width: var(--max-width);
    margin: 0 auto;
  }

  .grid-item {
    background: var(--color-bg);
    border-radius: var(--radius-md);
    overflow: hidden;
    border: 1px solid var(--color-border);
    transition: box-shadow var(--transition-base);
  }

  .grid-item:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .grid-item img {
    width: 100%;
    aspect-ratio: 3/2;
    object-fit: cover;
  }

  .grid-item-content {
    padding: var(--space-lg);
  }

  .grid-item-content h3 {
    font-size: var(--text-xl);
    margin-bottom: var(--space-sm);
  }

  .grid-item-content p {
    color: var(--color-text-light);
    font-size: var(--text-sm);
    margin-bottom: var(--space-md);
  }

  .grid-link {
    color: var(--color-accent);
    font-weight: 600;
    font-size: var(--text-sm);
    transition: color var(--transition-fast);
  }

  .grid-link:hover {
    color: var(--color-accent-hover);
  }

  @media (max-width: 1024px) {
    .grid-items {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 640px) {
    .grid-items {
      grid-template-columns: 1fr;
    }
  }
</style>
